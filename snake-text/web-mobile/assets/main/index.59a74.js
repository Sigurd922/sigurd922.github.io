window.__require=function e(t,n,a){function i(s,r){if(!n[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var h="function"==typeof __require&&__require;if(!r&&h)return h(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,n,a)}return n[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<a.length;s++)i(a[s]);return i}({CameraController:[function(e,t,n){"use strict";cc._RF.push(t,"c79e5ndld9Et4rRR/5ExJdS","CameraController"),cc.Class({extends:cc.Component,properties:{targetNode:{default:null,type:cc.Node},moveRangeX:cc.v2(-400,400),moveRangeY:cc.v2(-700,700)},start:function(){},update:function(e){if(null!=this.targetNode){var t=this.targetNode.position;t.x=cc.math.clamp(t.x,this.moveRangeX.x,this.moveRangeX.y),t.y=cc.math.clamp(t.y,this.moveRangeY.x,this.moveRangeY.y),this.node.setPosition(t)}}}),cc._RF.pop()},{}],Food:[function(e,t,n){"use strict";var a;cc._RF.push(t,"9affe660uhGurFMjeAn75+k","Food"),a=cc.Enum({Apple:0,Banana:1,Bomb:2}),cc.Class({extends:cc.Component,properties:{type:{default:a.Apple,type:a},addScore:10,addEnergy:0,id:-1,text:""},onLoad:function(){},init:function(e,t){this.id=e,this.text=t,this.node.children[0].getComponent(cc.Label).string=t}}),cc._RF.pop()},{}],GameManager:[function(e,t,n){"use strict";var a;cc._RF.push(t,"08637/D+/lCNqUK1C2sOZ2l","GameManager"),a=cc.Enum({Apple:0,Banana:1,Bomb:2}),cc.Class({extends:cc.Component,properties:{uiManager:{default:null,type:cc.Node},snake:{default:null,type:cc.Node},foodApplePrefab:{default:null,type:cc.Prefab},foodBananaPrefab:{default:null,type:cc.Prefab},foodBombPrefab:{default:null,type:cc.Prefab},initAppleNum:3,initBananaNum:3,initBombNum:3,avoidSnakeRadius:200,avoidFoodRadius:80,spawnRangeX:cc.v2(-400,400),spawnRangeY:cc.v2(-700,700),levelTextList:[cc.String],timeLimit:150},onLoad:function(){this.uiManager=this.uiManager.getComponent("UIManager"),this.snake=this.snake.getComponent("Snake"),this.currLevel=cc.sys.localStorage.getItem("_GAME_LEVEL"),null==this.currLevel?(this.currLevel=0,cc.sys.localStorage.setItem("_GAME_LEVEL",0),console.log("[GameManager] == null")):this.currLevel=parseInt(this.currLevel),console.log("[GameManager] currLevel",this.currLevel)},start:function(){this.textCount=0,this.currLevelText=this.levelTextList[this.currLevel],this.currLevelTextLen=this.currLevelText.length,this.foodArray=[];for(var e=0;e<this.initAppleNum;e++)this.spawnFood(a.Apple);for(var t=0;t<this.initBananaNum;t++)this.spawnFood(a.Banana);for(var n=0;n<this.initBombNum;n++)this.spawnFood(a.Bomb);this.updateProgressUI(0)},spawnFood:function(e){if(!(e==a.Apple&&this.textCount>=this.currLevelTextLen)){var t=null;t=e==a.Apple?this.foodApplePrefab:e==a.Banana?this.foodBananaPrefab:this.foodBombPrefab;var n=cc.instantiate(t);this.node.parent.addChild(n);var i=this.getRandomPosForFood();n.setPosition(i),e==a.Apple&&(n.getComponent("Food").init(this.textCount,this.currLevelText[this.textCount]),this.textCount+=1),this.foodArray.push(n)}},onSnakeEatFood:function(e){this.spawnFood(e),e==a.Apple&&this.updateProgressUI(this.snake.currTextId+1)},updateProgressUI:function(e){for(var t="",n="",a="",i=0;i<this.currLevelText.length;i++)i<e?n+=this.currLevelText[i]+" ":i>e?a+=this.currLevelText[i]+" ":t=this.currLevelText[i];this.uiManager.updateProgressText(t,0),this.uiManager.updateProgressText(n,1),this.uiManager.updateProgressText(a,2)},getRandomPosInRange:function(e,t){var n=cc.math.randomRange(e.x,e.y),a=cc.math.randomRange(t.x,t.y);return cc.v2(n,a)},getRandomPosForFood:function(){var e,t,n,a=0;do{e=this.getRandomPosInRange(this.spawnRangeX,this.spawnRangeY),t=cc.Vec2.distance(e,this.snake.node.position),n=99999;for(var i=0;i<this.foodArray.length;i++)if(null!=this.foodArray[i]){var o=cc.Vec2.distance(e,this.foodArray[i].position);n>o&&(n=o)}a+=1}while((t<this.avoidSnakeRadius||n<this.avoidFoodRadius)&&a<30);return a>1&&console.log("[GameManager] tryCount",a,t),e}}),cc._RF.pop()},{}],Sample:[function(e,t,n){"use strict";cc._RF.push(t,"5ea90qW/3xIgYXdOjoAxyXb","Sample"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],SetZIndex:[function(e,t,n){"use strict";cc._RF.push(t,"c19e4GfHnhKLZW6Mj418Fnu","SetZIndex"),cc.Class({extends:cc.Component,properties:{zIndex:0,setForChildren:!0},onLoad:function(){this.node.zIndex=this.zIndex,this.setForChildren&&this.setZIndexForChildren(this.node)},start:function(){},setZIndexForChildren:function(e){e.zIndex=this.zIndex;for(var t=0;t<e.children.length;t++)e.children[t].zIndex=this.zIndex}}),cc._RF.pop()},{}],Snake:[function(e,t,n){"use strict";var a;cc._RF.push(t,"db03egJOmFALoxy8y5zKKBE","Snake"),cc.Enum({Apple:0,Banana:1,Bomb:2}),a=cc.Enum({Pause:0,Start:1,Playing:2,Finish:3}),cc.Class({extends:cc.Component,properties:{gameState:{default:a.Start,type:a},bodyPrefab:{default:null,type:cc.Prefab},overlayTouch:{default:null,type:cc.Node},gameManager:{default:null,type:cc.Node},bodyNum:2,sectionLen:25,moveTime:20,collisionDelayTime:3,headZIndex:999,maxSkillEnergy:100},startGame:function(){this.changeGameState(a.Playing)},changeGameState:function(e){this.gameState=e},isGamePause:function(){return this.gameState==a.Pause},isGameStart:function(){return this.gameState==a.Start},isGamePlaying:function(){return this.gameState==a.Playing},isGameFinish:function(){return this.gameState==a.Finish},onLoad:function(){console.log("onLoad"),this.gameTimer=0,this.gameScore=0,this.skillEnergy=0,this.currTextId=-1,this.snakeArray=[],this.snakeArray.push(this.node),this.pointsArray=[],this.speed=this.sectionLen/this.moveTime;for(var e=1;e<=this.bodyNum;e++)this.getNewBody("");this.dir=null,this.dirAngle=0,this.headPointsNum=0,cc.director.getCollisionManager().enabled=!0,this.startTouchPos=cc.v2.ZERO,this.overlayTouch.on("touchstart",this.onTouchStart,this),this.overlayTouch.on("touchmove",this.onTouchMove,this),this.overlayTouch.on("touchend",this.onTouchEnd,this),this.overlayTouch.on("touchcancel",this.onTouchCancel,this)},onTouchStart:function(e){this.startTouchPos=e.getLocation()},onTouchMove:function(e){},onTouchEnd:function(e){var t=e.getLocation().x-this.startTouchPos.x,n=e.getLocation().y-this.startTouchPos.y,a=Math.abs(t),i=Math.abs(n);if(a+i>20){var o=null,s=0;a>i?t>0?(o=cc.v2(1,0),s=270):(o=cc.v2(-1,0),s=90):n>0?(o=cc.v2(0,1),s=0):(o=cc.v2(0,-1),s=180),(null==this.dir||o.x+this.dir.x!=0&&o.y+this.dir.y!=0)&&(this.node.angle=s,this.dir=o)}},onTouchCancel:function(e){},start:function(){console.log("start"),this.gameManager=this.gameManager.getComponent("GameManager"),this.uiManager=this.gameManager.uiManager},randomColor:function(){var e=Math.round(255*Math.random()),t=Math.round(255*Math.random()),n=Math.round(255*Math.random());return new cc.Color(e,t,n)},randomPos:function(){var e=this.node.parent.width,t=this.node.parent.height,n=Math.round(Math.random()*e)-e/2,a=Math.round(Math.random()*t)-t/2;return cc.v2(n,a)},getNewBody:function(e){console.log("getNewBody");var t=cc.instantiate(this.bodyPrefab);if(this.snakeArray.length>this.bodyNum?t.curIndex=this.snakeArray[this.snakeArray.length-1].curIndex:t.curIndex=0,1==this.snakeArray.length){var n=this.node.position.normalize();t.setPosition(this.node.position.sub(n.mul(this.sectionLen)))}else{var a=this.snakeArray[this.snakeArray.length-1],i=this.snakeArray[this.snakeArray.length-2].position.sub(a.position).normalize();t.setPosition(a.position.sub(i.mul(this.sectionLen)))}t.color=this.randomColor(),t.children[0].getComponent(cc.Label).string=e,this.node.parent.addChild(t),this.snakeArray.push(t),this.recordPoints(),this.changeZIndex()},rotateHead:function(e){var t=180*cc.v2(1,0).signAngle(e)/Math.PI;this.node.angle=t-90},moveSnake:function(){var e=this.dir.mul(this.speed);this.node.setPosition(this.node.position.add(e)),this.pointsArray.push(this.node.position),this.headPointsNum+=1;for(var t=(this.pointsArray.length-this.headPointsNum)/(this.snakeArray.length-1),n=1;n<this.snakeArray.length;n++){var a=Math.floor(t*(this.snakeArray.length-1-n));this.snakeArray[n].setPosition(this.pointsArray[a+this.snakeArray[n].curIndex]),this.snakeArray[n].curIndex+=1}},recordPoints:function(){for(var e=0,t=0;e<this.sectionLen;){e+=this.speed;var n=this.snakeArray[this.snakeArray.length-1],a=this.snakeArray[this.snakeArray.length-2].position.sub(n.position).normalize(),i=n.position.add(a.mul(e));this.pointsArray.splice(t,0,i),t+=1}},changeZIndex:function(){for(var e=0;e<this.snakeArray.length;e++)this.snakeArray[e].zIndex=this.headZIndex-e},onCollisionEnter:function(e,t){if(this.isGamePlaying())if(console.log("onCollisionEnter",e.node.group),e.node.group.includes("food")){var n=e.node.getComponent("Food");console.log("food",n.type);var i=!1;if(0==n.type){if(this.currTextId!=n.id-1)return console.log("fail: wrong text",n.id,this.currTextId),void e.node.setPosition(this.gameManager.getRandomPosForFood());this.currTextId=n.id,this.getNewBody(n.text),this.currTextId>=this.gameManager.currLevelTextLen-1&&(i=!0)}else 1==n.type||n.type;this.gameScore+=n.addScore,this.skillEnergy+=n.addEnergy,this.uiManager.updateScoreText(this.gameScore),this.uiManager.updateEnergyBar(this.skillEnergy/this.maxSkillEnergy),e.node.removeFromParent(),this.gameManager.onSnakeEatFood(n.type),i&&(this.changeGameState(a.Finish),this.uiManager.onGameFinish(!0))}else this.gameTimer>this.collisionDelayTime&&(this.changeGameState(a.Finish),this.uiManager.onGameFinish(!1))},update:function(e){this.isGamePlaying()&&this.dir&&(this.gameTimer+=e,this.moveSnake())}}),cc._RF.pop()},{}],UIManager:[function(e,t,n){"use strict";cc._RF.push(t,"a3d916enitFVJF4i3GHw+kh","UIManager"),cc.Class({extends:cc.Component,properties:{gameManager:{default:null,type:cc.Node},mainPanel:{default:null,type:cc.Node},startPanel:{default:null,type:cc.Node},gamePanel:{default:null,type:cc.Node},settleWinPanel:{default:null,type:cc.Node},settleLosePanel:{default:null,type:cc.Node},levelText:{default:null,type:cc.Label},scoreText:{default:null,type:cc.Label},timerText:{default:null,type:cc.Label},energyBar:{default:null,type:cc.ProgressBar},progressMidText:{default:null,type:cc.Label},progressLeftText:{default:null,type:cc.Label},progressRightText:{default:null,type:cc.Label},resumeGameNode:{default:null,type:cc.Node},settleScoreText:{default:null,type:cc.Label}},start:function(){this.gameManager=this.gameManager.getComponent("GameManager"),this.snake=this.gameManager.snake,this.mainPanel.active=!0,this.startPanel.active=!1,this.gamePanel.active=!1,this.settleWinPanel.active=!1,this.settleLosePanel.active=!1,this.gameTimer=this.gameManager.timeLimit,this.timerFunc=function(){this.gameTimer-=1;var e=Math.floor(this.gameTimer/60),t=this.gameTimer%60;e<10&&(e="0"+e),t<10&&(t="0"+t),this.timerText.string=e+":"+t},this.timerText.string="0:00";var e=cc.sys.localStorage.getItem("_GAME_LEVEL");e=parseInt(e),this.levelText.string="\u5173\u5361 "+(e+1),this.updateScoreText("0"),this.updateEnergyBar(0)},updateScoreText:function(e){this.scoreText.string=e},updateEnergyBar:function(e){this.energyBar.progress=e},updateProgressText:function(e,t){0==t?this.progressMidText.string=e:1==t?this.progressLeftText.string=e:this.progressRightText.string=e},startGame:function(){console.log("startGame"),this.mainPanel.active=!1,this.gamePanel.active=!0,this.snake.startGame(),this.schedule(this.timerFunc,1,999999,1)},onGameFinish:function(e){console.log("onGameFinish",e),this.unschedule(this.timerFunc),e?(this.settleWinPanel.active=!0,this.settleScoreText.string=this.scoreText.string):this.settleLosePanel.active=!0},restartGame:function(){console.log("restartGame"),cc.director.loadScene(cc.director.getScene().name)},toNextLevel:function(){console.log("toNextLevel");var e=cc.sys.localStorage.getItem("_GAME_LEVEL");e=parseInt(e),cc.sys.localStorage.setItem("_GAME_LEVEL",e+1),cc.director.loadScene(cc.director.getScene().name)},pauseGame:function(){this.resumeGameNode.active=!0,cc.game.pause()},resumeGame:function(){this.resumeGameNode.active=!1,cc.game.resume()},resetAll:function(){console.log("resetAll"),cc.sys.localStorage.clear(),cc.director.loadScene(cc.director.getScene().name)}}),cc._RF.pop()},{}]},{},["CameraController","Food","GameManager","Sample","SetZIndex","Snake","UIManager"]);